<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Мастера — тест</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .masters-header {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    .filter-panel {
      margin-bottom: 20px;
      border: 1px solid #ddd;
      padding: 10px;
    }
    .filter-group {
      margin-right: 20px;
      display: inline-block;
    }
    .filter-checkbox-item {
      margin: 4px 0;
    }
    .masters-grid {
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(3, 1fr);
    }
    .master-card-div {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      background: #fafafa;
    }
    .master-photo {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 8px;
    }
    .master-name {
      margin: 5px 0;
      font-weight: bold;
    }
    .no-results {
      margin-top: 20px;
      color: red;
      font-weight: bold;
    }
    .hidden {
      display: none;
    }
    .pagination {
      margin-top: 20px;
      text-align: center;
    }
    .pagination button {
      margin: 0 4px;
      padding: 6px 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: #fff;
      cursor: pointer;
    }
    .pagination button.active {
      background: #007bff;
      color: #fff;
    }

    /* адаптив */
    @media (max-width: 768px) {
      .masters-grid {
        grid-template-columns: repeat(1, 1fr);
      }
    }
  </style>
</head>
<body>

  <div class="masters-container">
    <p class="masters-header">Мастера</p>

    <!-- Фильтры -->
    <div class="filter-panel">
      <div class="filter-group">
        <p><b>Город</b></p>
        <div id="cityFilters"></div>
      </div>
      <div class="filter-group">
        <p><b>Вид практики</b></p>
        <div id="practiceFilters"></div>
      </div>
    </div>

    <!-- Сетка -->
    <div class="masters-grid" id="mastersGrid"></div>

    <!-- Нет результатов -->
    <div class="no-results hidden" id="noResults">
      Мастера по данному направлению не найдены
    </div>

    <!-- Пагинация -->
    <div class="pagination" id="pagination"></div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const mastersGrid = document.getElementById("mastersGrid");
      const noResults = document.getElementById("noResults");
      const pagination = document.getElementById("pagination");

      let allMasters = [];
      let filteredMasters = [];
      let currentPage = 1;
      const itemsPerPageDesktop = 6;
      const itemsPerPageMobile = 2;

      // ---- Тестовые данные ----
      allMasters = [
        { first_name: "Иван", second_name: "Смирнов", city: "Москва", practices: ["Цигун"], photo: "https://placekitten.com/300/200" },
        { first_name: "Анна", second_name: "Иванова", city: "Санкт-Петербург", practices: ["Багуа"], photo: "https://placekitten.com/301/200" },
        { first_name: "Олег", second_name: "Кузнецов", city: "Москва", practices: ["Цигун","Багуа"], photo: "https://placekitten.com/302/200" },
        { first_name: "Мария", second_name: "Петрова", city: "Новосибирск", practices: ["Йога"], photo: "https://placekitten.com/303/200" },
        { first_name: "Дмитрий", second_name: "Соколов", city: "Москва", practices: ["Айкидо"], photo: "https://placekitten.com/304/200" },
        { first_name: "Елена", second_name: "Васильева", city: "Санкт-Петербург", practices: ["Йога","Цигун"], photo: "https://placekitten.com/305/200" },
        { first_name: "Андрей", second_name: "Николаев", city: "Москва", practices: ["Багуа"], photo: "https://placekitten.com/306/200" },
        { first_name: "Светлана", second_name: "Козлова", city: "Новосибирск", practices: ["Айкидо"], photo: "https://placekitten.com/307/200" },
        { first_name: "Михаил", second_name: "Попов", city: "Москва", practices: ["Йога"], photo: "https://placekitten.com/308/200" },
      ];

      filteredMasters = allMasters;

      // Собираем уникальные города и практики
      function buildFilters() {
        const cityFilters = document.getElementById("cityFilters");
        const practiceFilters = document.getElementById("practiceFilters");

        const cities = [...new Set(allMasters.map(m => m.city))];
        const practices = [...new Set(allMasters.flatMap(m => m.practices))];

        cities.forEach(city => {
          const div = document.createElement("div");
          div.className = "filter-checkbox-item";
          div.innerHTML = `
            <input type="checkbox" class="filter-checkbox" value="${city}" id="city_${city}">
            <label for="city_${city}">${city}</label>
          `;
          cityFilters.appendChild(div);
        });

        practices.forEach(p => {
          const div = document.createElement("div");
          div.className = "filter-checkbox-item";
          div.innerHTML = `
            <input type="checkbox" class="filter-checkbox" value="${p}" id="practice_${p}">
            <label for="practice_${p}">${p}</label>
          `;
          practiceFilters.appendChild(div);
        });

        document.querySelectorAll(".filter-checkbox").forEach(cb => {
          cb.addEventListener("change", applyFilters);
        });
      }

      // Фильтрация
      function applyFilters() {
        const selectedCities = [...document.querySelectorAll("#cityFilters input:checked")].map(cb => cb.value);
        const selectedPractices = [...document.querySelectorAll("#practiceFilters input:checked")].map(cb => cb.value);

        filteredMasters = allMasters.filter(master => {
          const cityMatch = selectedCities.length === 0 || selectedCities.includes(master.city);
          const practiceMatch = selectedPractices.length === 0 || master.practices.some(p => selectedPractices.includes(p));
          return cityMatch && practiceMatch;
        });

        currentPage = 1;
        render();
      }

      // Рендер карточек
      function render() {
        mastersGrid.innerHTML = "";
        const isMobile = window.innerWidth < 768;
        const itemsPerPage = isMobile ? itemsPerPageMobile : itemsPerPageDesktop;

        const start = (currentPage - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const pageItems = filteredMasters.slice(start, end);

        if (pageItems.length === 0) {
          noResults.classList.remove("hidden");
        } else {
          noResults.classList.add("hidden");
        }

        pageItems.forEach(master => {
          mastersGrid.innerHTML += `
            <div class="master-card-div">
              <img src="${master.photo}" alt="" class="master-photo">
              <p class="master-name">${master.first_name} ${master.second_name}</p>
              <p><b>Город:</b> ${master.city}</p>
              <div><b>Практики:</b> ${master.practices.join(", ")}</div>
            </div>
          `;
        });

        renderPagination(itemsPerPage);
      }

      // Рендер пагинации
      function renderPagination(itemsPerPage) {
        pagination.innerHTML = "";
        const pageCount = Math.ceil(filteredMasters.length / itemsPerPage);

        for (let i = 1; i <= pageCount; i++) {
          const btn = document.createElement("button");
          btn.innerText = i;
          btn.className = i === currentPage ? "active" : "";
          btn.addEventListener("click", () => {
            currentPage = i;
            render();
          });
          pagination.appendChild(btn);
        }
      }

      window.addEventListener("resize", render);

      buildFilters();
      render();
    });
  </script>
</body>
</html>
